From f50aa645aa8382c919f5c243a031d7f135893b6d Mon Sep 17 00:00:00 2001
From: Beniamino Galvani <bgalvani@redhat.com>
Date: Thu, 9 May 2019 11:10:08 +0200
Subject: [PATCH 1/3] vpn: minor improvements

---
 src/vpn/nm-vpn-connection.c | 29 ++++++++---------------------
 src/vpn/nm-vpn-connection.h |  5 +----
 2 files changed, 9 insertions(+), 25 deletions(-)

diff --git a/src/vpn/nm-vpn-connection.c b/src/vpn/nm-vpn-connection.c
index 5acf491a2..1a07377c9 100644
--- a/src/vpn/nm-vpn-connection.c
+++ b/src/vpn/nm-vpn-connection.c
@@ -112,7 +112,6 @@ typedef struct {
 	NMVpnPluginInfo *plugin_info;
 	char *bus_name;
 
-	/* Firewall */
 	NMFirewallManagerCallId fw_call;
 
 	NMNetns *netns;
@@ -653,15 +652,19 @@ _set_vpn_state (NMVpnConnection *self,
 static gboolean
 _service_and_connection_can_persist (NMVpnConnection *self)
 {
-	return NM_VPN_CONNECTION_GET_PRIVATE (self)->connection_can_persist &&
-	       NM_VPN_CONNECTION_GET_PRIVATE (self)->service_can_persist;
+	NMVpnConnectionPrivate *priv = NM_VPN_CONNECTION_GET_PRIVATE (self);
+
+	return    priv->connection_can_persist
+	       && priv->service_can_persist;
 }
 
 static gboolean
 _connection_only_can_persist (NMVpnConnection *self)
 {
-	return NM_VPN_CONNECTION_GET_PRIVATE (self)->connection_can_persist &&
-	       !NM_VPN_CONNECTION_GET_PRIVATE (self)->service_can_persist;
+	NMVpnConnectionPrivate *priv = NM_VPN_CONNECTION_GET_PRIVATE (self);
+
+	return    priv->connection_can_persist
+	       && !priv->service_can_persist;
 }
 
 static void
@@ -2466,22 +2469,6 @@ nm_vpn_connection_get_ip_ifindex (NMVpnConnection *self, gboolean fallback_devic
 	return _get_ip_iface_for_device (self, NULL);
 }
 
-guint32
-nm_vpn_connection_get_ip4_internal_gateway (NMVpnConnection *self)
-{
-	g_return_val_if_fail (NM_IS_VPN_CONNECTION (self), 0);
-
-	return NM_VPN_CONNECTION_GET_PRIVATE (self)->ip4_internal_gw;
-}
-
-struct in6_addr *
-nm_vpn_connection_get_ip6_internal_gateway (NMVpnConnection *self)
-{
-	g_return_val_if_fail (NM_IS_VPN_CONNECTION (self), 0);
-
-	return NM_VPN_CONNECTION_GET_PRIVATE (self)->ip6_internal_gw;
-}
-
 void
 nm_vpn_connection_disconnect (NMVpnConnection *self,
                               NMActiveConnectionStateReason reason,
diff --git a/src/vpn/nm-vpn-connection.h b/src/vpn/nm-vpn-connection.h
index e70590b24..38163bee8 100644
--- a/src/vpn/nm-vpn-connection.h
+++ b/src/vpn/nm-vpn-connection.h
@@ -58,7 +58,7 @@ void                 nm_vpn_connection_activate        (NMVpnConnection *self,
                                                         NMVpnPluginInfo *plugin_info);
 NMVpnConnectionState nm_vpn_connection_get_vpn_state   (NMVpnConnection *self);
 const char *         nm_vpn_connection_get_banner      (NMVpnConnection *self);
-const char *        nm_vpn_connection_get_service     (NMVpnConnection *self);
+const char *         nm_vpn_connection_get_service     (NMVpnConnection *self);
 
 gboolean             nm_vpn_connection_deactivate      (NMVpnConnection *self,
                                                         NMActiveConnectionStateReason reason,
@@ -73,9 +73,6 @@ NMIP4Config *        nm_vpn_connection_get_ip4_config  (NMVpnConnection *self);
 NMIP6Config *        nm_vpn_connection_get_ip6_config  (NMVpnConnection *self);
 const char *         nm_vpn_connection_get_ip_iface    (NMVpnConnection *self, gboolean fallback_device);
 int                  nm_vpn_connection_get_ip_ifindex  (NMVpnConnection *self, gboolean fallback_device);
-guint32              nm_vpn_connection_get_ip4_internal_gateway (NMVpnConnection *self);
-struct in6_addr *    nm_vpn_connection_get_ip6_internal_gateway (NMVpnConnection *self);
-
 guint32              nm_vpn_connection_get_ip4_route_metric (NMVpnConnection *self);
 guint32              nm_vpn_connection_get_ip6_route_metric (NMVpnConnection *self);
 
-- 
2.22.0-rc1

