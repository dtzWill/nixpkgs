From df319f889ddc952dd065bbb3252d045b90baaf8e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michel=20D=C3=A4nzer?= <michel.daenzer@amd.com>
Date: Wed, 24 Jan 2018 12:28:38 +0100
Subject: [PATCH 14/24] xf86XvMCScreenInit: Clear pScreenPriv->dixinfo when
 freeing pAdapt
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Fixes double-free later in xf86XvMCCloseScreen, which would generally
cause fireworks.

Reviewed-by: Adam Jackson <ajax@redhat.com>
Signed-off-by: Michel DÃ¤nzer <michel.daenzer@amd.com>
(cherry picked from commit 75408f53d4e203e462b2f13ea4b06264f0e59ad2)
---
 hw/xfree86/common/xf86xvmc.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/hw/xfree86/common/xf86xvmc.c b/hw/xfree86/common/xf86xvmc.c
index a0a94c74b..c67418bf4 100644
--- a/hw/xfree86/common/xf86xvmc.c
+++ b/hw/xfree86/common/xf86xvmc.c
@@ -187,6 +187,7 @@ xf86XvMCScreenInit(ScreenPtr pScreen,
         }
         if (!pAdapt[i].xv_adaptor) {
             /* no adaptor by that name */
+            pScreenPriv->dixinfo = FALSE;
             free(pAdapt);
             return FALSE;
         }
-- 
2.19.0

